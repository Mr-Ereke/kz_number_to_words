- pipeline: build
  name: Build
  refs:
  - refs/heads/main
  events:
  - type: PUSH
  fail_on_prepare_env_warning: true
  resources: NANO
  actions:
  - action: composer install
    type: BUILD
    docker_image_name: library/php
    docker_image_tag: 8.3
    execute_commands:
    - composer validate
    - composer self-update
    - composer install
    - composer dump-autoload
    - php -d xdebug.mode=coverage vendor/bin/phpunit --configuration phpunit.xml
    setup_commands:
    - echo "memory_limit=-1" >> /usr/local/etc/php/conf.d/buddy.ini
    - apt-get update && apt-get install -y git zip
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
    shell: BASH
